<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM ARM to Bicep Converter</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        .input-section, .output-section {
            padding: 30px;
        }
        .input-section {
            border-right: 1px solid #eee;
        }
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-bottom: 15px;
        }
        textarea:focus {
            border-color: #667eea;
            outline: none;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
        }
        .config-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .config-group {
            display: flex;
            flex-direction: column;
        }
        .config-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        .config-group input, .config-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .config-group input:focus, .config-group select:focus {
            border-color: #667eea;
            outline: none;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .sample-link {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }
        .sample-link:hover {
            color: #5a6fd8;
        }
        .output-bicep {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 280px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ VM ARM to Bicep Converter</h1>
            <p>Convert your VM ARM templates to Bicep with custom region, VNet, and subnet settings</p>
        </div>
        
        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <div class="section-title">üì• ARM Template Input</div>
                
                <div class="controls">
                    <span class="sample-link" onclick="loadSampleVM()">üìÅ Load Sample VM</span> |
                    <span class="sample-link" onclick="clearInput()">üóëÔ∏è Clear</span>
                </div>
                
                <textarea id="armInput" placeholder="Paste your VM ARM template JSON here...

Example structure:
{
  &quot;$schema&quot;: &quot;...&quot;,
  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
  &quot;parameters&quot;: { ... },
  &quot;resources&quot;: [ ... ]
}"></textarea>
                
                <div class="config-panel">
                    <div style="font-weight: 600; margin-bottom: 15px; color: #333;">‚öôÔ∏è Customization Settings</div>
                    
                    <div class="config-row">
                        <div class="config-group">
                            <label>üåç Target Region</label>
                            <select id="targetRegion">
                                <option value="eastus">East US</option>
                                <option value="eastus2">East US 2</option>
                                <option value="westus">West US</option>
                                <option value="westus2">West US 2</option>
                                <option value="centralus">Central US</option>
                                <option value="westeurope">West Europe</option>
                                <option value="northeurope">North Europe</option>
                                <option value="southeastasia">Southeast Asia</option>
                                <option value="australiaeast">Australia East</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label>üîó VNet Name</label>
                            <input type="text" id="vnetName" value="my-vnet" placeholder="Virtual Network name">
                        </div>
                    </div>
                    
                    <div class="config-row">
                        <div class="config-group">
                            <label>üè∑Ô∏è Subnet Name</label>
                            <input type="text" id="subnetName" value="default" placeholder="Subnet name">
                        </div>
                        <div class="config-group">
                            <label>üì¶ Resource Group</label>
                            <input type="text" id="resourceGroup" value="rg-vm-${targetRegion}" placeholder="Resource group name">
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn-primary" onclick="convertToBicep()">üîÑ Convert to Bicep</button>
                    <button class="btn-secondary" onclick="analyzeTemplate()">üîç Analyze ARM</button>
                </div>
                
                <div id="inputResults" class="results" style="display: none;"></div>
            </div>
            
            <!-- Output Section -->
            <div class="output-section">
                <div class="section-title">üì§ Bicep Output</div>
                
                <div class="controls">
                    <div class="tooltip">
                        <button class="btn-success" onclick="copyToClipboard()" id="copyBtn" disabled>üìã Copy Bicep</button>
                        <span class="tooltiptext">
                            <strong>Copy to Clipboard</strong><br>
                            ‚Ä¢ Uses modern clipboard API when available<br>
                            ‚Ä¢ Falls back to older browser support<br>
                            ‚Ä¢ Works in secure (HTTPS) and local contexts
                        </span>
                    </div>
                    <button class="btn-info" onclick="selectAllBicep()" id="selectBtn" disabled>üìù Select All</button>
                    <button class="btn-secondary" onclick="downloadBicep()" id="downloadBtn" disabled>üíæ Download .bicep</button>
                </div>
                
                <div id="bicepOutput" class="output-bicep">
                    Ready to convert. Paste your VM ARM template on the left and click "Convert to Bicep".
                </div>
                
                <div id="outputResults" class="results" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentBicep = '';

        function loadSampleVM() {
            const sampleVM = {
                "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                "contentVersion": "1.0.0.0",
                "parameters": {
                    "vmName": {
                        "type": "string",
                        "defaultValue": "myVM",
                        "metadata": {
                            "description": "Name of the virtual machine"
                        }
                    },
                    "adminUsername": {
                        "type": "string",
                        "defaultValue": "azureuser",
                        "metadata": {
                            "description": "Username for the Virtual Machine"
                        }
                    },
                    "adminPassword": {
                        "type": "securestring",
                        "metadata": {
                            "description": "Password for the Virtual Machine"
                        }
                    },
                    "vmSize": {
                        "type": "string",
                        "defaultValue": "Standard_D2s_v3",
                        "metadata": {
                            "description": "Size of the virtual machine"
                        }
                    }
                },
                "variables": {
                    "nicName": "[concat(parameters('vmName'), '-nic')]",
                    "vnetName": "myVNet",
                    "subnetName": "default",
                    "publicIPName": "[concat(parameters('vmName'), '-pip')]",
                    "nsgName": "[concat(parameters('vmName'), '-nsg')]"
                },
                "resources": [
                    {
                        "type": "Microsoft.Network/publicIPAddresses",
                        "apiVersion": "2021-02-01",
                        "name": "[variables('publicIPName')]",
                        "location": "[resourceGroup().location]",
                        "properties": {
                            "publicIPAllocationMethod": "Dynamic"
                        }
                    },
                    {
                        "type": "Microsoft.Network/networkSecurityGroups",
                        "apiVersion": "2021-02-01",
                        "name": "[variables('nsgName')]",
                        "location": "[resourceGroup().location]",
                        "properties": {
                            "securityRules": [
                                {
                                    "name": "SSH",
                                    "properties": {
                                        "priority": 1001,
                                        "access": "Allow",
                                        "direction": "Inbound",
                                        "destinationPortRange": "22",
                                        "protocol": "Tcp",
                                        "sourcePortRange": "*",
                                        "sourceAddressPrefix": "*",
                                        "destinationAddressPrefix": "*"
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "type": "Microsoft.Network/networkInterfaces",
                        "apiVersion": "2021-02-01",
                        "name": "[variables('nicName')]",
                        "location": "[resourceGroup().location]",
                        "dependsOn": [
                            "[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPName'))]",
                            "[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]"
                        ],
                        "properties": {
                            "ipConfigurations": [
                                {
                                    "name": "ipconfig1",
                                    "properties": {
                                        "privateIPAllocationMethod": "Dynamic",
                                        "publicIPAddress": {
                                            "id": "[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPName'))]"
                                        },
                                        "subnet": {
                                            "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', variables('vnetName'), variables('subnetName'))]"
                                        }
                                    }
                                }
                            ],
                            "networkSecurityGroup": {
                                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]"
                            }
                        }
                    },
                    {
                        "type": "Microsoft.Compute/virtualMachines",
                        "apiVersion": "2021-03-01",
                        "name": "[parameters('vmName')]",
                        "location": "[resourceGroup().location]",
                        "dependsOn": [
                            "[resourceId('Microsoft.Network/networkInterfaces', variables('nicName'))]"
                        ],
                        "properties": {
                            "hardwareProfile": {
                                "vmSize": "[parameters('vmSize')]"
                            },
                            "osProfile": {
                                "computerName": "[parameters('vmName')]",
                                "adminUsername": "[parameters('adminUsername')]",
                                "adminPassword": "[parameters('adminPassword')]"
                            },
                            "storageProfile": {
                                "imageReference": {
                                    "publisher": "Canonical",
                                    "offer": "0001-com-ubuntu-server-focal",
                                    "sku": "20_04-lts-gen2",
                                    "version": "latest"
                                },
                                "osDisk": {
                                    "createOption": "FromImage",
                                    "managedDisk": {
                                        "storageAccountType": "Premium_LRS"
                                    }
                                }
                            },
                            "networkProfile": {
                                "networkInterfaces": [
                                    {
                                        "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('nicName'))]"
                                    }
                                ]
                            }
                        }
                    }
                ]
            };

            document.getElementById('armInput').value = JSON.stringify(sampleVM, null, 2);
            showResult('inputResults', 'info', 'üìÅ Sample VM ARM template loaded! Click "Convert to Bicep" to see the result.');
        }

        function clearInput() {
            document.getElementById('armInput').value = '';
            document.getElementById('bicepOutput').textContent = 'Ready to convert. Paste your VM ARM template on the left and click "Convert to Bicep".';
            hideResults();
            disableButtons();
        }

        function analyzeTemplate() {
            const input = document.getElementById('armInput').value.trim();
            
            if (!input) {
                showResult('inputResults', 'error', '‚ùå Please paste an ARM template first.');
                return;
            }

            try {
                const template = JSON.parse(input);
                
                let analysis = '<strong>üìä ARM Template Analysis:</strong><br><br>';
                analysis += `‚Ä¢ Schema: ${template.$schema || 'Not specified'}<br>`;
                analysis += `‚Ä¢ Content Version: ${template.contentVersion || 'Not specified'}<br>`;
                analysis += `‚Ä¢ Parameters: ${template.parameters ? Object.keys(template.parameters).length : 0}<br>`;
                analysis += `‚Ä¢ Variables: ${template.variables ? Object.keys(template.variables).length : 0}<br>`;
                analysis += `‚Ä¢ Resources: ${template.resources ? template.resources.length : 0}<br><br>`;
                
                if (template.resources && template.resources.length > 0) {
                    analysis += '<strong>üîç Resources Found:</strong><br>';
                    template.resources.forEach((resource, index) => {
                        analysis += `${index + 1}. ${resource.type} (${resource.apiVersion})<br>`;
                    });
                }
                
                showResult('inputResults', 'success', analysis);
                
            } catch (error) {
                showResult('inputResults', 'error', `‚ùå Invalid JSON: ${error.message}`);
            }
        }

        function convertToBicep() {
            const input = document.getElementById('armInput').value.trim();
            const targetRegion = document.getElementById('targetRegion').value;
            const vnetName = document.getElementById('vnetName').value;
            const subnetName = document.getElementById('subnetName').value;
            const resourceGroup = document.getElementById('resourceGroup').value;
            
            if (!input) {
                showResult('inputResults', 'error', '‚ùå Please paste an ARM template first.');
                return;
            }

            try {
                const template = JSON.parse(input);
                const bicep = convertArmToBicep(template, {
                    targetRegion,
                    vnetName,
                    subnetName,
                    resourceGroup
                });
                
                currentBicep = bicep;
                document.getElementById('bicepOutput').textContent = bicep;
                enableButtons();
                
                showResult('outputResults', 'success', `‚úÖ Successfully converted to Bicep! Updated region to ${targetRegion}, VNet to ${vnetName}, and subnet to ${subnetName}.`);
                
            } catch (error) {
                showResult('outputResults', 'error', `‚ùå Conversion failed: ${error.message}`);
                disableButtons();
            }
        }

        function convertArmToBicep(template, config) {
            let bicep = `// ============================================================================
// VM Bicep Template - Converted and Customized
// Target Region: ${config.targetRegion}
// VNet: ${config.vnetName}
// Subnet: ${config.subnetName}
// ============================================================================

targetScope = 'resourceGroup'

// === PARAMETERS ===
`;

            // Add parameters
            if (template.parameters) {
                Object.keys(template.parameters).forEach(paramName => {
                    const param = template.parameters[paramName];
                    bicep += `@description('${param.metadata?.description || paramName}')\n`;
                    if (param.defaultValue !== undefined) {
                        bicep += `param ${paramName} ${param.type} = '${param.defaultValue}'\n\n`;
                    } else {
                        bicep += `param ${paramName} ${param.type}\n\n`;
                    }
                });
            }

            // Add custom parameters
            bicep += `@description('Target region for deployment')
param location string = '${config.targetRegion}'

@description('Virtual network name')
param vnetName string = '${config.vnetName}'

@description('Subnet name')
param subnetName string = '${config.subnetName}'

// === VARIABLES ===
`;

            // Add variables (converted from ARM syntax)
            if (template.variables) {
                Object.keys(template.variables).forEach(varName => {
                    let varValue = template.variables[varName];
                    if (typeof varValue === 'string') {
                        // Convert ARM expressions to Bicep
                        varValue = convertArmExpressionToBicep(varValue);
                    }
                    bicep += `var ${varName} = ${varValue}\n`;
                });
                bicep += '\n';
            }

            bicep += `// === RESOURCES ===
`;

            // Convert resources
            if (template.resources) {
                template.resources.forEach(resource => {
                    bicep += convertResourceToBicep(resource, config);
                    bicep += '\n';
                });
            }

            return bicep;
        }

        function convertResourceToBicep(resource, config) {
            let bicep = `// ${resource.type}\n`;
            const resourceName = extractResourceName(resource.name);
            
            bicep += `resource ${sanitizeName(resourceName)} '${resource.type}@${resource.apiVersion}' = {\n`;
            bicep += `  name: ${convertArmExpressionToBicep(resource.name)}\n`;
            bicep += `  location: location\n`;
            
            if (resource.dependsOn && resource.dependsOn.length > 0) {
                bicep += `  dependsOn: [\n`;
                resource.dependsOn.forEach(dep => {
                    const depName = extractResourceNameFromResourceId(dep);
                    bicep += `    ${sanitizeName(depName)}\n`;
                });
                bicep += `  ]\n`;
            }
            
            if (resource.properties) {
                bicep += `  properties: {\n`;
                bicep += convertPropertiesToBicep(resource.properties, config, 2);
                bicep += `  }\n`;
            }
            
            bicep += `}\n`;
            
            return bicep;
        }

        function convertPropertiesToBicep(properties, config, indent = 0) {
            let bicep = '';
            const spaces = '  '.repeat(indent);
            
            Object.keys(properties).forEach(key => {
                const value = properties[key];
                bicep += `${spaces}${key}: `;
                
                if (typeof value === 'string') {
                    // Handle special network references
                    if (key === 'subnet' && value.includes('virtualNetworks')) {
                        bicep += `{\n${spaces}  id: resourceId('Microsoft.Network/virtualNetworks/subnets', vnetName, subnetName)\n${spaces}}\n`;
                    } else {
                        bicep += `${convertArmExpressionToBicep(value)}\n`;
                    }
                } else if (typeof value === 'object' && value !== null) {
                    if (Array.isArray(value)) {
                        bicep += `[\n`;
                        value.forEach(item => {
                            if (typeof item === 'object') {
                                bicep += `${spaces}  {\n`;
                                bicep += convertPropertiesToBicep(item, config, indent + 2);
                                bicep += `${spaces}  }\n`;
                            } else {
                                bicep += `${spaces}  ${convertArmExpressionToBicep(item.toString())}\n`;
                            }
                        });
                        bicep += `${spaces}]\n`;
                    } else {
                        bicep += `{\n`;
                        bicep += convertPropertiesToBicep(value, config, indent + 1);
                        bicep += `${spaces}}\n`;
                    }
                } else {
                    bicep += `${value}\n`;
                }
            });
            
            return bicep;
        }

        function convertArmExpressionToBicep(armExpression) {
            if (typeof armExpression !== 'string') {
                return JSON.stringify(armExpression);
            }
            
            // Convert ARM template functions to Bicep
            let bicepExpression = armExpression
                .replace(/\[parameters\('([^']+)'\)\]/g, '$1')
                .replace(/\[variables\('([^']+)'\)\]/g, '$1')
                .replace(/\[resourceGroup\(\)\.location\]/g, 'location')
                .replace(/\[concat\(([^)]+)\)\]/g, (match, args) => {
                    const parts = args.split(',').map(part => part.trim().replace(/'/g, ''));
                    return `'${parts.join('')}'`;
                })
                .replace(/\[resourceId\('([^']+)',\s*([^)]+)\)\]/g, "resourceId('$1', $2)");
            
            // If it looks like a parameter reference, clean it up
            if (bicepExpression.match(/^[a-zA-Z][a-zA-Z0-9]*$/)) {
                return bicepExpression;
            }
            
            // If it's a string literal, wrap in quotes
            if (!bicepExpression.startsWith("'") && !bicepExpression.includes('(')) {
                return `'${bicepExpression}'`;
            }
            
            return bicepExpression;
        }

        function extractResourceName(nameExpression) {
            // Extract a clean name from ARM template name expressions
            if (typeof nameExpression === 'string') {
                if (nameExpression.includes("parameters('")) {
                    return nameExpression.replace(/.*parameters\('([^']+)'\).*/, '$1');
                }
                if (nameExpression.includes("variables('")) {
                    return nameExpression.replace(/.*variables\('([^']+)'\).*/, '$1');
                }
                return nameExpression.replace(/[\[\]']/g, '');
            }
            return 'resource';
        }

        function extractResourceNameFromResourceId(resourceId) {
            // Extract resource name from resourceId function
            const match = resourceId.match(/variables\('([^']+)'\)/);
            return match ? match[1] : 'resource';
        }

        function sanitizeName(name) {
            // Make sure the name is valid for Bicep
            return name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
        }

        function copyToClipboard() {
            if (!currentBicep) {
                showResult('outputResults', 'error', '‚ùå Nothing to copy. Please convert an ARM template first.');
                return;
            }

            // Prefer modern clipboard API when available
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(currentBicep).then(() => {
                    showResult('outputResults', 'success', 'üìã Bicep code copied to clipboard!');
                }).catch((err) => {
                    // Fallback to older execCommand approach
                    console.warn('navigator.clipboard failed, falling back to execCommand:', err);
                    fallbackCopyTextToClipboard(currentBicep);
                });
            } else {
                // Fallback for insecure contexts or older browsers
                fallbackCopyTextToClipboard(currentBicep);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                // Avoid scrolling to bottom
                textarea.style.position = 'fixed';
                textarea.style.left = '-9999px';
                textarea.style.top = '0';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();

                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);

                if (successful) {
                    showResult('outputResults', 'success', 'üìã Bicep code copied to clipboard (fallback)!');
                } else {
                    showResult('outputResults', 'error', '‚ùå Failed to copy to clipboard using fallback. Please select and copy manually.');
                }
            } catch (e) {
                console.error('Fallback copy failed', e);
                showResult('outputResults', 'error', '‚ùå Failed to copy to clipboard. Please select and copy manually.');
            }
        }

        function downloadBicep() {
            const blob = new Blob([currentBicep], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vm-template.bicep';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showResult('outputResults', 'success', 'üíæ Bicep file downloaded!');
        }

        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = `results ${type}`;
            element.innerHTML = message;
            element.style.display = 'block';
        }

        function hideResults() {
            document.getElementById('inputResults').style.display = 'none';
            document.getElementById('outputResults').style.display = 'none';
        }

        function enableButtons() {
            document.getElementById('copyBtn').disabled = false;
            document.getElementById('selectBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = false;
        }

        function disableButtons() {
            document.getElementById('copyBtn').disabled = true;
            document.getElementById('selectBtn').disabled = true;
            document.getElementById('downloadBtn').disabled = true;
        }

        function selectAllBicep() {
            if (!currentBicep) {
                showResult('outputResults', 'error', '‚ùå Nothing to select. Please convert an ARM template first.');
                return;
            }

            const outputElement = document.getElementById('bicepOutput');
            
            // Create a range to select all text content
            if (window.getSelection && document.createRange) {
                const range = document.createRange();
                range.selectNodeContents(outputElement);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                showResult('outputResults', 'info', 'üìù All Bicep code selected. Use Ctrl+C (Cmd+C on Mac) to copy.');
            } else {
                // Fallback for older browsers
                showResult('outputResults', 'error', '‚ùå Text selection not supported in this browser. Please use the Copy button or select manually.');
            }
        }

        // Initialize
        disableButtons();
    </script>
</body>
</html>